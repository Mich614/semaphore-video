- name: Create a new VM on a given ESXi hostname
  community.vmware.vmware_guest:
    hostname: "{{ localhost.localdomain }}"
    username: "{{ root }}"
    password: "{{ Datait2024! }}"
    folder: /Ansible_vm/test_vm/
    name: Ubuntu_test
    state: poweredon
    guest_id: centos64Guest
    # This is hostname of particular ESXi server on which user wants VM to be deployed
    esxi_hostname: "{{ localhost.localdomain }}"
    disk:
    - size_gb: 20
      type: thin
      datastore: DataStore
    hardware:
      memory_mb: 2048
      num_cpus: 1
      scsi: paravirtual
    networks:
    - name: VM Network
      mac: aa:bb:dd:aa:00:14
      ip: 192.168.20.99
      netmask: 255.255.255.0
      device_type: vmxnet3
    wait_for_ip_address: true
    wait_for_ip_address_timeout: 600
  delegate_to: localhost
  register: deploy_vm
